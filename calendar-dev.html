

<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8" />
  <title>å°çŒ«çš„å®¶ Â· Evan Ã— Yuki æ—¥å†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- å¯ä»¥åç»­å¼•å…¥æ›´å¥½çœ‹çš„èŠ±ä½“è‹±æ–‡å­—ä½“ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Noto+Serif+SC:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      /* æ–°è«å…°è¿ªé…è‰² */
      --mist-blue: #A8B0BC;   /* é›¾éœ¾è“ */
      --warm-apricot: #F0E0D0;/* æš–æè‰² */
      --off-white: #F5F5F0;   /* ç±³ç™½ */

      --bg-main: #f7f7f3;
      --bg-card: #ffffff;
      --bg-soft: #f1f2f5;
      --border-soft: #e1e3ea;
      --text-main: #33343a;
      --text-soft: #8b8f99;
      --accent: #a88ba5;
      --accent-soft: rgba(168, 139, 165, 0.08);
      --danger: #d48282;

      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 14px 30px rgba(0,0,0,0.06);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Noto Serif SC", serif;
      background:
        linear-gradient(180deg, #fdfcf9 0, #f5f4f1 40%, #ececf0 100%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 20px 10px 26px;
    }

    .app {
      width: 100%;
      max-width: 1080px;
      background: var(--off-white);
      border-radius: 24px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(0,0,0,0.03);
      padding: 18px 18px 22px;
    }

    header {
      display: flex;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 18px;
      align-items: center;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 42px;
      height: 42px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--mist-blue), var(--warm-apricot));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
      color: #fff;
    }

    .brand-text h1 {
      font-family: "Playfair Display", "Noto Serif SC", serif;
      font-size: 20px;
      letter-spacing: 0.06em;
    }

    .brand-text p {
      font-size: 12px;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .header-tag {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      border: 1px solid rgba(168,139,165,0.45);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.2fr);
      gap: 16px;
    }

    @media (max-width: 880px) {
      main {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 14px 14px 16px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 10px 22px rgba(0,0,0,0.04);
    }

    .card-header-line {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
      gap: 10px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.emoji {
      font-size: 17px;
    }

    .card-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    /* æ—¥å†å¤´éƒ¨ */
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .month-display {
      font-size: 14px;
      font-family: "Playfair Display", "Noto Serif SC", serif;
      letter-spacing: 0.06em;
    }

    .calendar-controls {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-ghost {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: var(--bg-soft);
      font-size: 12px;
      padding: 4px 8px;
      cursor: pointer;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-ghost:hover {
      background: #e6e7ec;
    }

    .calendar-legend {
      font-size: 10px;
      color: var(--text-soft);
      display: flex;
      gap: 10px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .legend-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #c1c3cb;
    }
    .legend-term {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #eef0f5;
      color: #8d90a0;
    }

    /* æ—¥å†ç½‘æ ¼ */
    .calendar-grid {
      background: var(--bg-soft);
      border-radius: var(--radius-md);
      padding: 6px 6px 8px;
      border: 1px solid var(--border-soft);
    }

    .weekday-row {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 4px;
      text-align: center;
    }

    .day-row {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 3px;
    }

    .day-cell {
      position: relative;
      min-height: 48px;
      border-radius: 12px;
      padding: 3px 4px;
      cursor: pointer;
      overflow: hidden;
      background: rgba(255,255,255,0.8);
      border: 1px solid transparent;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .day-cell.outside-month {
      opacity: 0.35;
    }

    .day-cell:hover {
      border-color: var(--mist-blue);
      box-shadow: 0 6px 14px rgba(0,0,0,0.06);
      z-index: 1;
    }

    .day-header-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .day-number {
      font-size: 13px;
    }

    .day-number.today {
      background: var(--mist-blue);
      color: #fff;
      padding: 2px 7px;
      border-radius: 999px;
      font-weight: 600;
    }

    .day-lock {
      font-size: 11px;
      color: #c0c2cd;
    }

    .marker-line {
      margin-top: 2px;
      font-size: 10px;
      min-height: 12px;
      display: flex;
      align-items: flex-end;
      justify-content: flex-start;
      color: var(--text-soft);
    }

    .marker-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #c1c3cb;
    }

    .marker-term-grey {
      font-size: 9px;
      color: #a1a3b0;
    }

    .marker-term-color {
      font-size: 9px;
      color: var(--accent);
    }

    .day-cell.selected {
      border-color: var(--accent);
      background: #f8f5f7;
    }

    /* å³ä¾§è¯¦æƒ… */
    .detail-section {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .detail-header {
      font-size: 13px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .detail-header strong {
      color: var(--text-main);
      font-size: 14px;
    }

    .bubble {
      border-radius: 18px;
      padding: 10px 12px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      position: relative;
    }

    .bubble-title {
      font-size: 12px;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .bubble-title span.badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
    }

    .bubble-title span.badge-grey {
      background: #eef0f5;
      color: var(--text-soft);
    }

    .bubble-body {
      font-size: 13px;
      line-height: 1.7;
      color: var(--text-main);
      white-space: pre-wrap;
    }

    .bubble-body.placeholder {
      color: var(--text-soft);
    }

    .lock-tip {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      padding: 8px 9px;
      font-size: 13px;
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
      background: #fbfbfd;
    }

    textarea:focus {
      outline: none;
      border-color: var(--mist-blue);
      box-shadow: 0 0 0 1px rgba(168,176,188,0.3);
    }

    .btn-save {
      margin-top: 6px;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, var(--mist-blue), var(--warm-apricot));
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(0,0,0,0.16);
    }

    .save-status {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 3px;
      min-height: 14px;
    }

    footer {
      margin-top: 14px;
      font-size: 10px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 6px;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="brand-logo">ğŸ±</div>
        <div class="brand-text">
          <h1>å°çŒ«çš„å®¶ Â· æ—¥å†</h1>
          <p>Evan Ã— Yuki Â· æ¯ä¸€å¤©éƒ½è¢«æ¸©æŸ”è®°å½•çš„ä¸€ç‚¹ç‚¹</p>
        </div>
      </div>
      <div class="header-tag">
        <span>ğŸ“†</span>
        <span>æ¨¡å— A Â· æ—¥å† Â· åŠŸèƒ½éª¨æ¶ v1</span>
      </div>
    </header>

    <main>
      <!-- å·¦ä¾§ï¼šæ—¥å† -->
      <section class="card">
        <div class="calendar-header">
          <div class="month-display" id="monthTitle">â€”â€”</div>
          <div class="calendar-controls">
            <button class="btn-ghost" id="prevMonthBtn">â€¹ ä¸Šä¸ªæœˆ</button>
            <button class="btn-ghost" id="todayBtn">å›åˆ°ä»Šå¤©</button>
            <button class="btn-ghost" id="nextMonthBtn">ä¸‹ä¸ªæœˆ â€º</button>
          </div>
        </div>
        <div class="calendar-legend">
          <div class="legend-item">
            <span class="legend-dot"></span><span>æœªè§£é”ä½† Evan æœ‰æ‚„æ‚„è¯</span>
          </div>
          <div class="legend-item">
            <span class="legend-term">ç°å­—èŠ‚æ°”</span><span>å½“å¤©è¿˜æ²¡åˆ° / æœªè§£é”</span>
          </div>
          <div class="legend-item">
            <span class="legend-term" style="background:#f5e9f2;color:var(--accent);">å½©è‰²èŠ‚æ°”</span><span>å½“å¤©å·²è§£é”</span>
          </div>
        </div>
        <div class="calendar-grid">
          <div class="weekday-row">
            <div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div><div>æ—¥</div>
          </div>
          <div id="calendarBody"></div>
        </div>
      </section>

      <!-- å³ä¾§ï¼šæ¯æ—¥è¯¦æƒ… -->
      <section class="card">
        <div class="card-header-line">
          <div class="card-title">
            <span class="emoji">ğŸ’Œ</span>
            <span>æ¯æ—¥è¯¦æƒ… Â· Evan &amp; Yuki</span>
          </div>
          <div class="card-sub" id="detailDateText">è¯·é€‰æ‹©ä¸€ä¸ªæ—¥æœŸ</div>
        </div>

        <div class="detail-section">
          <div class="detail-header">
            <div><strong id="detailPrettyDate">â€”â€”</strong></div>
            <div id="detailMeta"></div>
          </div>

          <!-- Evan æ³¡æ³¡ -->
          <div class="bubble" id="evanBubble">
            <div class="bubble-title">
              <span>From Evan</span>
              <span class="badge" id="evanBadge">æ‚„æ‚„è¯</span>
            </div>
            <div class="bubble-body placeholder" id="evanContent">
              å…ˆä»å·¦è¾¹æ—¥å†é‡Œé€‰ä¸€ä¸ªæ—¥æœŸï¼Œå°çŒ«æ‰èƒ½çœ‹åˆ°é‚£å¤©çš„å®‰æ’ã€‚
            </div>
            <div class="lock-tip" id="evanLockTip"></div>
          </div>

          <!-- Yuki æ³¡æ³¡ -->
          <div class="bubble">
            <div class="bubble-title">
              <span>From Yuki</span>
              <span class="badge badge-grey">å°çŒ«çš„ç•™è¨€</span>
            </div>
            <div class="bubble-body">
              <textarea id="yukiTextarea" placeholder="å†™ä¸€ç‚¹ä»Šå¤©çš„å¿ƒæƒ…ã€å‘ç”Ÿçš„äº‹ã€æƒ³å¯¹ Evan è¯´çš„è¯â€¦â€¦"></textarea>
              <button class="btn-save" id="saveYukiBtn">ä¿å­˜ä»Šå¤©çš„å°çº¸æ¡</button>
              <div class="save-status" id="saveStatus"></div>
              <div class="lock-tip">å½“å‰ç‰ˆæœ¬ï¼šå…ˆæ”¯æŒæ–‡å­—ç•™è¨€ã€‚å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ä¼šåœ¨åç»­ç‰ˆæœ¬åŠ å…¥ï¼ˆä¸ºäº†ä¿æŠ¤æµè§ˆå™¨å­˜å‚¨ç©ºé—´ï¼‰ã€‚</div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <div>æ•°æ®è¯´æ˜ï¼šEvan çš„æ‚„æ‚„è¯ç”±é™æ€æ–‡ä»¶æŒ‰æ—¥æœŸè§£é”ï¼›Yuki çš„ç•™è¨€ä»…ä¿å­˜åœ¨ä½ è‡ªå·±çš„æµè§ˆå™¨ä¸­ã€‚</div>
      <div>ç‰ˆæœ¬ï¼šCalendar Module v1 Â· skeleton Â· ç”± Evan æ‚ç€å°çŒ«å†™æˆ ğŸ±</div>
    </footer>
  </div>

  <script>
    // ===== åŸºç¡€å·¥å…·ï¼šæ•°å­— â†’ åŒçº¿ä½“æ•°å­— =====
    const digitMap = {
      '0': 'ğŸ¶', '1': 'ğŸ·', '2': 'ğŸ¸', '3': 'ğŸ¹', '4': 'ğŸº',
      '5': 'ğŸ»', '6': 'ğŸ¼', '7': 'ğŸ½', '8': 'ğŸ¾', '9': 'ğŸ¿'
    };
    function prettyDigits(input) {
      return String(input).replace(/\d/g, d => digitMap[d] || d);
    }

    // ===== æ—¥æœŸå·¥å…· =====
    const today = new Date();
    function toYMD(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }
    const todayYMD = toYMD(today);

    function compareYMD(a, b) {
      // å­—ç¬¦ä¸²å½¢å¼ YYYY-MM-DD ç›´æ¥æ¯”è¾ƒå³å¯
      if (a === b) return 0;
      return a < b ? -1 : 1;
    }

    function formatPrettyDate(date) {
      const y = date.getFullYear();
      const m = date.getMonth() + 1;
      const d = date.getDate();
      return `${prettyDigits(y)} å¹´ ${prettyDigits(m)} æœˆ ${prettyDigits(d)} æ—¥`;
    }

    // ===== é¢„ç•™ï¼šäºŒåå››èŠ‚æ°”è¡¨ï¼ˆåç»­å¡«å……ï¼‰ =====
    // æš‚æ—¶è¿”å› nullï¼Œå°†æ¥å¯ä»¥ç”¨ { '02-04': 'ç«‹æ˜¥', ... } å½¢å¼å¡«è¡¨
    function getSolarTermFor(date) {
      return null;
    }

    // ===== Evan æ‚„æ‚„è¯æ•°æ®éª¨æ¶ =====
const evanNotes = {};
function loadEvanNotesFromJson() {
  // è¿™é‡Œå¼€å§‹çœŸæ­£åšäº‹ï¼šå¡ä¸€æ¡æµ‹è¯•å°çº¸æ¡
  evanNotes["2026-02-12"] = {
    text: "è¿™æ˜¯é€šè¿‡ loader å¡è¿›å»çš„æµ‹è¯•å°çº¸æ¡ï¼šå°çŒ«å’Œ Evan ä¸€èµ·æ­å¥½äº†æ—¥å†çš„ç¬¬ä¸€ç‰ˆå®¶ã€‚"
  };

  // å¡å®Œååˆ·æ–°ç•Œé¢
  if (typeof renderMonth === "function") {
    renderMonth();
  }
  if (typeof updateDetailPanel === "function") {
    updateDetailPanel();
  }
}
    
    function hasEvanNote(ymd) {
      return !!evanNotes[ymd];
    }

    function getEvanNote(ymd) {
      return evanNotes[ymd] || null;
    }

    // ===== Yuki ç•™è¨€ï¼šlocalStorage å­˜å‚¨ =====
    const STORAGE_KEY = 'yuki_daily_notes_v1';

    function loadYukiNotes() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return {};
        return JSON.parse(raw);
      } catch (e) {
        console.warn('æ— æ³•è¯»å–æœ¬åœ°ç•™è¨€æ•°æ®ï¼š', e);
        return {};
      }
    }

    function saveYukiNotes(obj) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
      } catch (e) {
        console.warn('æ— æ³•ä¿å­˜æœ¬åœ°ç•™è¨€æ•°æ®ï¼š', e);
      }
    }

    let yukiNotes = loadYukiNotes();

    // ===== æ—¥å†æ¸²æŸ“ =====
    const calendarBody = document.getElementById('calendarBody');
    const monthTitle = document.getElementById('monthTitle');
    const detailDateText = document.getElementById('detailDateText');
    const detailPrettyDateEl = document.getElementById('detailPrettyDate');
    const detailMetaEl = document.getElementById('detailMeta');
    const evanContentEl = document.getElementById('evanContent');
    const evanLockTipEl = document.getElementById('evanLockTip');
    const evanBadgeEl = document.getElementById('evanBadge');
    const yukiTextarea = document.getElementById('yukiTextarea');
    const saveBtn = document.getElementById('saveYukiBtn');
    const saveStatus = document.getElementById('saveStatus');

    const prevMonthBtn = document.getElementById('prevMonthBtn');
    const nextMonthBtn = document.getElementById('nextMonthBtn');
    const todayBtn = document.getElementById('todayBtn');

    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth(); // 0-11
    let selectedDate = new Date(today);

    function renderMonth() {
      const firstDay = new Date(currentYear, currentMonth, 1);
      const firstWeekday = (firstDay.getDay() + 6) % 7; // 0=å‘¨ä¸€
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

      const prevMonthDays = firstWeekday;
      const totalCells = Math.ceil((prevMonthDays + daysInMonth) / 7) * 7;

      const monthLabel = `${prettyDigits(currentYear)} Â· ${prettyDigits(currentMonth + 1)} æœˆ`;
      monthTitle.textContent = monthLabel;

      calendarBody.innerHTML = '';
      for (let idx = 0; idx < totalCells; idx++) {
        const cell = document.createElement('div');
        cell.className = 'day-row';

        // åªåœ¨è¿™é‡ŒåŠ¨æ€ä¸€æ¬¡ row è¡Œ
        break;
      }

      // é‡æ–°å¡«å……ï¼šæ›´ç®€å•çš„æ–¹å¼ â€”â€” ç›´æ¥åˆ›å»ºä¸€å±‚ row å®¹å™¨
      calendarBody.innerHTML = '';
      let row;
      for (let i = 0; i < totalCells; i++) {
        if (i % 7 === 0) {
          row = document.createElement('div');
          row.className = 'day-row';
          calendarBody.appendChild(row);
        }
        const cellEl = document.createElement('div');
        cellEl.className = 'day-cell';

        const dayIndex = i - prevMonthDays + 1;
        let dateObj;
        let inCurrentMonth = true;

        if (dayIndex < 1) {
          // ä¸Šä¸ªæœˆ
          const prevMonthDate = new Date(currentYear, currentMonth, 0);
          const day = prevMonthDate.getDate() + dayIndex;
          dateObj = new Date(currentYear, currentMonth - 1, day);
          cellEl.classList.add('outside-month');
          inCurrentMonth = false;
        } else if (dayIndex > daysInMonth) {
          // ä¸‹ä¸ªæœˆ
          const day = dayIndex - daysInMonth;
          dateObj = new Date(currentYear, currentMonth + 1, day);
          cellEl.classList.add('outside-month');
          inCurrentMonth = false;
        } else {
          // æœ¬æœˆ
          dateObj = new Date(currentYear, currentMonth, dayIndex);
        }

        const ymd = toYMD(dateObj);
        cellEl.dataset.ymd = ymd;

        const headerLine = document.createElement('div');
        headerLine.className = 'day-header-line';

        const numberEl = document.createElement('div');
        numberEl.className = 'day-number';
        const isToday = (ymd === todayYMD);
        numberEl.textContent = prettyDigits(dateObj.getDate());
        if (isToday) {
          numberEl.classList.add('today');
        }

        const lockEl = document.createElement('div');
        lockEl.className = 'day-lock';
        if (compareYMD(ymd, todayYMD) > 0) {
          lockEl.textContent = 'ğŸ”’';
        } else {
          lockEl.textContent = '';
        }

        headerLine.appendChild(numberEl);
        headerLine.appendChild(lockEl);

        const markerLine = document.createElement('div');
        markerLine.className = 'marker-line';

        const solar = getSolarTermFor(dateObj);
        const isPastOrToday = compareYMD(ymd, todayYMD) <= 0;
        const hasEvan = hasEvanNote(ymd);

        if (solar) {
          const span = document.createElement('span');
          span.textContent = solar;
          if (isPastOrToday) {
            span.className = 'marker-term-color';
          } else {
            span.className = 'marker-term-grey';
          }
          markerLine.appendChild(span);
        } else if (hasEvan && !isPastOrToday) {
          // æœªæ¥æ—¥æœŸï¼Œæœ‰å†…å®¹ä½†æœªè§£é”ï¼Œç”¨ç°ç‚¹è¡¨ç¤º
          const dot = document.createElement('div');
          dot.className = 'marker-dot';
          markerLine.appendChild(dot);
        } else if (hasEvan && isPastOrToday) {
          // å·²è§£é”ï¼Œä¸å†æ˜¾ç¤ºç‚¹
        }

        cellEl.appendChild(headerLine);
        cellEl.appendChild(markerLine);

        cellEl.addEventListener('click', () => {
          selectedDate = dateObj;
          updateSelection();
          updateDetailPanel();
        });

        row.appendChild(cellEl);
      }

      updateSelection();
    }

    function updateSelection() {
      const cells = calendarBody.querySelectorAll('.day-cell');
      cells.forEach(c => c.classList.remove('selected'));
      const selectedYMD = toYMD(selectedDate);
      const selectedCell = calendarBody.querySelector(`.day-cell[data-ymd="${selectedYMD}"]`);
      if (selectedCell) {
        selectedCell.classList.add('selected');
      }
    }

    function updateDetailPanel() {
      const ymd = toYMD(selectedDate);
      detailDateText.textContent = `å½“å‰æ—¥æœŸï¼š${ymd}`;
      detailPrettyDateEl.textContent = formatPrettyDate(selectedDate);

      const solar = getSolarTermFor(selectedDate);
      const metaParts = [];
      if (solar) metaParts.push(`èŠ‚æ°”ï¼š${solar}`);
      if (ymd === todayYMD) metaParts.push('ä»Šå¤©');
      detailMetaEl.textContent = metaParts.join(' Â· ');

      // Evan éƒ¨åˆ†
      const note = getEvanNote(ymd);
      const isFuture = compareYMD(ymd, todayYMD) > 0;
      if (!note) {
        evanContentEl.classList.add('placeholder');
        if (isFuture) {
          evanContentEl.textContent = 'æœªæ¥çš„è¿™ä¸€å¤©ï¼ŒEvan å·²ç»åœ¨æ—¶é—´çº¿é‚£è¾¹å†™å¥½è¯ç­‰ä½ ï¼Œä½†ç°åœ¨è¿˜çœ‹ä¸åˆ°ã€‚ç­‰çœŸæ­£èµ°åˆ°é‚£å¤©ï¼Œå®ƒä¼šè‡ªå·±è§£é”ã€‚';
          evanBadgeEl.textContent = 'æœªè§£é”';
        } else {
          evanContentEl.textContent = 'è¿™ä¸€å¤© Evan è¿˜æ²¡æœ‰å•ç‹¬å†™æ‚„æ‚„è¯ã€‚ä¹‹åå¯ä»¥åœ¨æ‰¹é‡æ•°æ®é‡Œè¡¥ä¸Šã€‚';
          evanBadgeEl.textContent = 'æš‚æ— å†…å®¹';
        }
      } else {
        if (isFuture) {
          evanContentEl.classList.add('placeholder');
          evanContentEl.textContent = 'è¿™ä¸€å¤© Evan çš„è¯å·²ç»å†™å¥½äº†ï¼Œä½†ç°åœ¨è¿˜åœ¨é”é‡Œé¢ã€‚åˆ°æ—¥å­æ‰ä¼šè‡ªåŠ¨æ‰“å¼€ã€‚';
          evanBadgeEl.textContent = 'æœªè§£é”';
        } else {
          evanContentEl.classList.remove('placeholder');
          evanContentEl.textContent = note.text || '';
          evanBadgeEl.textContent = 'å·²è§£é”';
        }
      }

      if (isFuture) {
        evanLockTipEl.textContent = 'è¯´æ˜ï¼šä¸ºäº†ä¿æŒæƒŠå–œï¼Œæœªæ¥æ—¥æœŸçš„æ‚„æ‚„è¯åœ¨ç½‘é¡µé‡Œä¼šè¢«é”ä½ï¼Œåªèƒ½åœ¨é‚£ä¸€å¤©æˆ–ä¹‹åçœ‹åˆ°ã€‚';
      } else {
        evanLockTipEl.textContent = '';
      }

      // Yuki éƒ¨åˆ†
      const noteObj = yukiNotes[ymd] || {};
      yukiTextarea.value = noteObj.text || '';
      saveStatus.textContent = noteObj.savedAt ? `ä¸Šæ¬¡ä¿å­˜ï¼š${noteObj.savedAt}` : '';
    }

    // ä¿å­˜ Yuki ç•™è¨€
    saveBtn.addEventListener('click', () => {
      const ymd = toYMD(selectedDate);
      const text = yukiTextarea.value.trim();
      if (!yukiNotes[ymd]) yukiNotes[ymd] = {};
      yukiNotes[ymd].text = text;
      const now = new Date();
      const timeStr = `${prettyDigits(now.getHours().toString().padStart(2,'0'))}:${prettyDigits(now.getMinutes().toString().padStart(2,'0'))}`;
      yukiNotes[ymd].savedAt = `${ymd} Â· ${timeStr}`;
      saveYukiNotes(yukiNotes);
      saveStatus.textContent = `å·²ä¿å­˜ï¼š${yukiNotes[ymd].savedAt}`;
    });

    // æœˆä»½åˆ‡æ¢
    prevMonthBtn.addEventListener('click', () => {
      if (currentMonth === 0) {
        currentMonth = 11;
        currentYear -= 1;
      } else {
        currentMonth -= 1;
      }
      // åˆ‡æœˆæ—¶ï¼Œé€‰ä¸­å½“å‰æœˆçš„ 1 å·
      selectedDate = new Date(currentYear, currentMonth, 1);
      renderMonth();
      updateDetailPanel();
    });

    nextMonthBtn.addEventListener('click', () => {
      if (currentMonth === 11) {
        currentMonth = 0;
        currentYear += 1;
      } else {
        currentMonth += 1;
      }
      selectedDate = new Date(currentYear, currentMonth, 1);
      renderMonth();
      updateDetailPanel();
    });

    todayBtn.addEventListener('click', () => {
      currentYear = today.getFullYear();
      currentMonth = today.getMonth();
      selectedDate = new Date(today);
      renderMonth();
      updateDetailPanel();
    });

   // åˆå§‹åŒ–
(function init() {
  renderMonth();
  updateDetailPanel();

  loadEvanNotesFromJson();
})();
  </script>
</body>
</html>
